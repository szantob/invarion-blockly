<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Blockly Demo: Fixed Blockly</title>
  <script src="./js/blockly/blockly_compressed.js"></script>
  <script src="./js/blockly/blocks_compressed.js"></script>
  <script src="./js/blockly/msg/js/en.js"></script>
  <script src="./js/blockly/javascript_compressed.js"></script>
  <script src="./js/doll/conceptmodel.js"></script>
  <script src="./js/doll/vocabulary.js"></script>
  <script src="./js/doll/datamodel.js"></script>
  <script src="./js/doll/taxonomy.js"></script>
  <script id="toolboxxml" type="notjs" src="./toolbox.xml"></script>
  <style src="./css/style.css"></style>
  <script>
	var workspace_xml = 
		'<xml xmlns="https://developers.google.com/blockly/xml" id="toolbox" style="display: none">'+
		  '<category name="Concept Model Blocks">'+
			'<block type="concept_model">'+
			  '<field name="NAME">concept model name</field>'+
			'</block>'+
			'<block type="concept_model_dec_name">'+
			  '<field name="NAME">concept model name</field>'+
			'</block>'+
			'<block type="concept_model_dec_vocabulary">'+
			'</block>'+
			'<block type="concept_model_dec_taxonomy">'+
			'</block>'+
			'<block type="concept_model_dec_datamodel">'+
			'</block>'+
		  '</category>'+
		  '<category name="Vocabulary" custom="VOCABULARY"></category>'+
		  '<category name="Taxonomy" custom="TAXONOMY"></category>'+
		  '<category name="Data Model" custom="DATAMODEL"></category>'+
		'</xml>';
		var onSave = function(){
			console.log("Save");
		};
  </script>
</head>
<body>
	<nav width="100%" height="100px">
		<button onclick="onSave()">Save</button>
	</nav>
	<div id="blocklyDiv" style="height: 720px; width: 1280px;"></div>

	<xml xmlns="https://developers.google.com/blockly/xml" id="toolbox" style="display: none">
		<category name="Concept Model Blocks">
		</category>
	</xml>
	<xml xmlns="https://developers.google.com/blockly/xml" id="workspaceBlocks" style="display: none"></xml>

	<script>
	var toolbox = document.getElementById("toolbox");

	var options = { 
		toolbox : toolbox, 
		collapse : true, 
		comments : true, 
		disable : true, 
		maxBlocks : Infinity, 
		trashcan : true, 
		horizontalLayout : false, 
		toolboxPosition : 'start', 
		css : true, 
		media : 'https://blockly-demo.appspot.com/static/media/', 
		rtl : false, 
		scrollbars : true, 
		sounds : true, 
		oneBasedIndex : true
	};
	
	
	var toolboxUpdate = function(){
		workspace.updateToolbox(workspace_xml);
	}
	
	var workspace = Blockly.inject('blocklyDiv', options);
	workspace.registerToolboxCategoryCallback('VOCABULARY', vocabularyCallback);
	workspace.registerToolboxCategoryCallback('TAXONOMY', taxonomyCallback);
	workspace.registerToolboxCategoryCallback('DATAMODEL', datamodelCallback);
	workspace.registerButtonCallback('vocabularyNewEntry', vocabularyNewEntryCallback);
	workspace.registerButtonCallback('taxonomyNewEntry', taxonomyNewEntryCallback);
	var workspaceBlocks = document.getElementById("workspaceBlocks"); 
	Blockly.Xml.domToWorkspace(workspaceBlocks, workspace);
	toolboxUpdate();
	
	onSave = function(){
		console.log(Blockly.Xml.workspaceToDom(workspace));
	};
  </script>
</body>
</html>
